<!doctype html><html lang=en dir=auto data-theme=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>From Misconfiguration to RCE: A Deep Dive into Nextcloud Security ‚òÅÔ∏è | Giacomo Lenzini</title><meta name=keywords content="Red Team,Penetration Test,Cloud"><meta name=description content="During a recent penetration test, I came across a misconfigured Nextcloud instance. With the appropriate permissions, it was possible to achieve Remote Code Execution (RCE) in two distinct ways by leveraging built-in Nextcloud functionality. This post walks through the attack surface and outlines defensive measures.
Nextcloud is an open-source platform for file storage, collaboration, and communication. It allows users to sync files, share documents, manage calendars, and collaborate securely across devices and teams. In many ways, Nextcloud resembles popular cloud services such as Google Drive or Dropbox, but it offers the key advantage of complete data ownership and enhanced privacy."><meta name=author content="GiacoLenzo2109"><link rel=canonical href=http://localhost:1313/blog/nextcloud-rce/><link crossorigin=anonymous href=/assets/css/stylesheet.2d84eaa7ee42a3af126dfab51d3907fa2f8b04eb79a1e33660ea7eb53c219e0a.css integrity="sha256-LYTqp+5Co68Sbfq1HTkH+i+LBOt5oeM2YOp+tTwhngo=" rel="preload stylesheet" as=style><link rel=icon href=http://localhost:1313/favicon.ico><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/favicon-32x32.png><link rel=apple-touch-icon href=http://localhost:1313/apple-touch-icon.png><link rel=mask-icon href=http://localhost:1313/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=http://localhost:1313/blog/nextcloud-rce/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><meta property="og:url" content="http://localhost:1313/blog/nextcloud-rce/"><meta property="og:site_name" content="Giacomo Lenzini"><meta property="og:title" content="From Misconfiguration to RCE: A Deep Dive into Nextcloud Security ‚òÅÔ∏è"><meta property="og:description" content="During a recent penetration test, I came across a misconfigured Nextcloud instance. With the appropriate permissions, it was possible to achieve Remote Code Execution (RCE) in two distinct ways by leveraging built-in Nextcloud functionality. This post walks through the attack surface and outlines defensive measures.
Nextcloud is an open-source platform for file storage, collaboration, and communication. It allows users to sync files, share documents, manage calendars, and collaborate securely across devices and teams. In many ways, Nextcloud resembles popular cloud services such as Google Drive or Dropbox, but it offers the key advantage of complete data ownership and enhanced privacy."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2025-11-03T20:00:00+00:00"><meta property="article:modified_time" content="2025-11-03T20:00:00+00:00"><meta property="article:tag" content="Red Team"><meta property="article:tag" content="Penetration Test"><meta property="article:tag" content="Cloud"><meta property="og:image" content="http://localhost:1313/images/articles/nextcloud-rce/home_icon.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://localhost:1313/images/articles/nextcloud-rce/home_icon.png"><meta name=twitter:title content="From Misconfiguration to RCE: A Deep Dive into Nextcloud Security ‚òÅÔ∏è"><meta name=twitter:description content="During a recent penetration test, I came across a misconfigured Nextcloud instance. With the appropriate permissions, it was possible to achieve Remote Code Execution (RCE) in two distinct ways by leveraging built-in Nextcloud functionality. This post walks through the attack surface and outlines defensive measures.
Nextcloud is an open-source platform for file storage, collaboration, and communication. It allows users to sync files, share documents, manage calendars, and collaborate securely across devices and teams. In many ways, Nextcloud resembles popular cloud services such as Google Drive or Dropbox, but it offers the key advantage of complete data ownership and enhanced privacy."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Blogs","item":"http://localhost:1313/blog/"},{"@type":"ListItem","position":2,"name":"From Misconfiguration to RCE: A Deep Dive into Nextcloud Security ‚òÅÔ∏è","item":"http://localhost:1313/blog/nextcloud-rce/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"From Misconfiguration to RCE: A Deep Dive into Nextcloud Security ‚òÅÔ∏è","name":"From Misconfiguration to RCE: A Deep Dive into Nextcloud Security ‚òÅÔ∏è","description":"During a recent penetration test, I came across a misconfigured Nextcloud instance. With the appropriate permissions, it was possible to achieve Remote Code Execution (RCE) in two distinct ways by leveraging built-in Nextcloud functionality. This post walks through the attack surface and outlines defensive measures.\nNextcloud is an open-source platform for file storage, collaboration, and communication. It allows users to sync files, share documents, manage calendars, and collaborate securely across devices and teams. In many ways, Nextcloud resembles popular cloud services such as Google Drive or Dropbox, but it offers the key advantage of complete data ownership and enhanced privacy.\n","keywords":["Red Team","Penetration Test","Cloud"],"articleBody":"During a recent penetration test, I came across a misconfigured Nextcloud instance. With the appropriate permissions, it was possible to achieve Remote Code Execution (RCE) in two distinct ways by leveraging built-in Nextcloud functionality. This post walks through the attack surface and outlines defensive measures.\nNextcloud is an open-source platform for file storage, collaboration, and communication. It allows users to sync files, share documents, manage calendars, and collaborate securely across devices and teams. In many ways, Nextcloud resembles popular cloud services such as Google Drive or Dropbox, but it offers the key advantage of complete data ownership and enhanced privacy.\nIn my environment, I set up a test Nextcloud instance using the following command:\ndocker run -d -p 8080:80 nextcloud When mounts go wrong: RCE via Local File Storage Below are the exact environment details and the step-by-step actions I used to reproduce the issue.\nPrerequisites An account with the one of the following Nextcloud permissions:\nAbility to mount local/external storage ‚Äî permission to add/edit Local storage mounts via the External storages app.\nAbility to install/enable apps (plugins) ‚Äî permission to install, enable or configure apps.\nBy default, administrative accounts in Nextcloud have these capabilities. However, if the instance is misconfigured, standard users can also inherit permissions to mount storage (all except local ones) or install plugins, which may expose the system to security risks.\nFor clarity and reproducibility, the following demonstration uses an admin user who already possesses all required permissions.\nProof of Concept 1. Enable the External storage support app Navigate to the Apps section, specifically the installed applications list (http:///settings/apps/installed).\nLocate and enable the External storage support application. This step is crucial as it introduces the ability to mount remote and local filesystems into the nextcloud‚Äôs environment.\n2. Mounting a Local Filesystem as External Storage This is the critical misconfiguration that enables the attack.\nNavigate to Administrative Settings -\u003e External storage (http:///settings/admin/externalstorages).\nAdd a new storage entry with the following parameters:\nFolder Name: RCE (choose an arbitrary name) External Storage: Local Authentication: None Configuration: Set the directory to a path accessible by the web server, for example: /var/www/html. For simplicity, I have set up /. Available for: For the purpose of this PoC, this share is configured to be accessible by all users (\"All people\"). In a real-world attack, an attacker could limit this to specific users or groups. 3. Web Shell Upload and Remote Code Execution With the storage mounted, we can now upload and execute a web shell.\nIn the main application interface, navigate to All files. You will see the newly created RCE share.\nThe critical requirement for this exploit is that the uploaded file must be placed within a directory that is publicly accessible via the web server. By mounting the root filesystem /, we find and gain access to the web server‚Äôs document root (e.g. /var/www/html). We can then target a specific, existing folder that is already served by the web server. A perfect candidate for this is the /updater folder, which is used by Nextcloud for the built-in updater. This folder is already web-accessible and often has the necessary permissions. Uploading our file here ensures it is instantly available at http:///updater/.\nCreate the updater folder if it is not already present and upload a file (e.g. shell.php) containing a simple PHP web shell. For this demonstration, I used a basic one-liner:\n\u003c?php system($_GET['cmd']); ?\u003e Once uploaded, the file resides directly in /var/www/html/updater/ on the server. You can now trigger command execution by accessing the file directly via the web server.\n4. Triggering RCE The web shell is now directly accessible. Execute arbitrary commands by making an HTTP GET request to the following link: http:///updater/shell.php?cmd=\nRemediations Disable the ability for users to create new external storages of type Local by adding the following entry to the config.php (/var/www/html/config/config.php) file. This directly closes the primary vulnerability demonstrated in this PoC.\n'files_external_allow_create_new_local' =\u003e false RCE via ‚ÄúFile Actions‚Äù app: Abusing Elevated Privileges for Code Execution Overview The File Actions app extends Nextcloud‚Äôs functionality by allowing administrators to define a custom script that could be run through the file actions menu in the Files app.\nThe critical attack vector is introduced through its support for Lua scripting. This feature permits the definition of a file action where the associated command is a custom Lua script.\nPrerequisites The exploitation path requires an account with the following necessary privilege:\nAbility to install/enable apps (plugins) - permission to install, enable or configure apps. By default, this capability is restricted to admin. For clarity and reproducibility, the following demonstration uses an admin user who already possesses the required permission.\nProof of Concept 1. Install and enable the File Actions app As an administrator, navigate to the Apps management section, search for the File Actions app, allow untested apps to make it available, and finally install and enable it to integrate new file action capabilities into the platform.\n2. Create a new file action Navigate to Administration settings ‚Üí File Actions and create a new action.\nThe core of this exploitation lies in using the shell_command function provided by File Actions API (https://github.com/Raudius/files_scripts/blob/master/docs/Functions.md), which allows executing operating system-level commands on the underlying server.\nConfiguring User Inputs:\nThis step is crucial for interactively passing commands to the shell. In the User inputs section, add a new input variable.\nSet the Type to Text. Set the Name (e.g. cmd). This name must match the one used in the Lua script. Save the input variable. Paste the following Lua script into the command editor. This script dynamically executes any command supplied through the user input.\nresult = shell_command(get_input('cmd')) add_message(result.output) Explanation of the Script:\nget_input(‚Äòcmd‚Äô): This function retrieves the command string from the user input field named cmd.\nshell_command(‚Ä¶): This is the critical function that executes the supplied string as a shell command on the underlying operating system. The result of the execution is stored in the result variable.\nadd_message(result.output): This function takes the standard output (result.output) from the shell command and displays it to the user as a message within the Nextcloud interface. This provides immediate feedback and exfiltration of command results.\nOnce this action is saved, you must enable the Experimental Interpreter. This setting is crucial as it allows the system to process and execute the custom Lua code.\n3. Exploit RCE After enabling the interpreter, the action will appear in the file actions menu within the Files app. Simply select a file, open its context menu, and select your custom action (e.g., RCE). This will open a dialog box prompting for the cmd input. Enter any system command here to execute it on the server.\nThe command entered will be executed on the server and the output will be displayed directly in the Nextcloud interface. The following figures show the execution of the id command via the file action created previously (RCE).\nRemediations To completely remove the risk of malicious app installation, disable the app store for all users by adding the following entry to the config.php (/var/www/html/config/config.php) file. This prevents any user, including admins, from browsing or installing new applications from the web interface.\n'appstoreenabled' =\u003e false ","wordCount":"1187","inLanguage":"en","image":"http://localhost:1313/images/articles/nextcloud-rce/home_icon.png","datePublished":"2025-11-03T20:00:00Z","dateModified":"2025-11-03T20:00:00Z","author":{"@type":"Person","name":"GiacoLenzo2109"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:1313/blog/nextcloud-rce/"},"publisher":{"@type":"Organization","name":"Giacomo Lenzini","logo":{"@type":"ImageObject","url":"http://localhost:1313/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/ accesskey=h title="Giacomo Lenzini (Alt + H)"><img src=http://localhost:1313/apple-touch-icon.png alt aria-label=logo height=35>Giacomo Lenzini</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://localhost:1313/whoami/ title=Whoami><span>Whoami</span></a></li><li><a href=http://localhost:1313/blog/ title=Blog><span>Blog</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://localhost:1313/>Home</a>&nbsp;¬ª&nbsp;<a href=http://localhost:1313/blog/>Blogs</a></div><h1 class="post-title entry-hint-parent">From Misconfiguration to RCE: A Deep Dive into Nextcloud Security ‚òÅÔ∏è</h1><div class=post-meta><span title='2025-11-03 20:00:00 +0000 UTC'>November 3, 2025</span>&nbsp;¬∑&nbsp;<span>6 min</span>&nbsp;¬∑&nbsp;<span>GiacoLenzo2109</span></div></header><figure class=entry-cover><img loading=eager src=http://localhost:1313/images/articles/nextcloud-rce/home_icon.png alt></figure><div class=post-content><p>During a recent penetration test, I came across a misconfigured <strong>Nextcloud</strong> instance. With the appropriate permissions, it was possible to achieve <strong>Remote Code Execution (RCE)</strong> in two distinct ways by leveraging built-in Nextcloud functionality. This post walks through the attack surface and outlines defensive measures.</p><p><strong>Nextcloud</strong> is an open-source platform for file storage, collaboration, and communication. It allows users to sync files, share documents, manage calendars, and collaborate securely across devices and teams. In many ways, Nextcloud resembles popular cloud services such as Google Drive or Dropbox, but it offers the key advantage of complete data ownership and enhanced privacy.</p><p>In my environment, I set up a test Nextcloud instance using the following command:</p><pre tabindex=0><code>docker run -d -p 8080:80 nextcloud
</code></pre><h1 id=when-mounts-go-wrong-rce-via-local-file-storage>When mounts go wrong: RCE via Local File Storage<a hidden class=anchor aria-hidden=true href=#when-mounts-go-wrong-rce-via-local-file-storage>#</a></h1><p>Below are the exact environment details and the step-by-step actions I used to reproduce the issue.</p><h2 id=prerequisites>Prerequisites<a hidden class=anchor aria-hidden=true href=#prerequisites>#</a></h2><p>An account with the one of the following Nextcloud permissions:</p><ul><li><p><strong>Ability to mount local/external storage</strong> ‚Äî permission to add/edit Local storage mounts via the External storages app.</p></li><li><p><strong>Ability to install/enable apps (plugins)</strong> ‚Äî permission to install, enable or configure apps.</p></li></ul><p>By default, administrative accounts in Nextcloud have these capabilities. However, if the instance is misconfigured, standard users can also inherit permissions to mount storage (all except local ones) or install plugins, which may expose the system to security risks.</p><p>For clarity and reproducibility, the following demonstration uses an admin user who already possesses all required permissions.</p><h2 id=proof-of-concept>Proof of Concept<a hidden class=anchor aria-hidden=true href=#proof-of-concept>#</a></h2><h3 id=1-enable-the-external-storage-support-app>1. Enable the <em>External storage support</em> app<a hidden class=anchor aria-hidden=true href=#1-enable-the-external-storage-support-app>#</a></h3><p>Navigate to the <em>Apps</em> section, specifically the installed applications list (<code>http://&lt;TARGET_IP>/settings/apps/installed</code>).</p><p>Locate and enable the <em>External storage support</em> application. This step is crucial as it introduces the ability to mount remote and local filesystems into the nextcloud&rsquo;s environment.</p><p><img alt="Enable External Storage Support app" loading=lazy src=/images/articles/nextcloud-rce/enable_plugin.png></p><h3 id=2-mounting-a-local-filesystem-as-external-storage>2. Mounting a Local Filesystem as External Storage<a hidden class=anchor aria-hidden=true href=#2-mounting-a-local-filesystem-as-external-storage>#</a></h3><p>This is the critical misconfiguration that enables the attack.</p><p>Navigate to <em>Administrative Settings</em> -> <em>External storage</em> (<code>http://&lt;TARGET_IP>/settings/admin/externalstorages</code>).</p><p>Add a new storage entry with the following parameters:</p><ul><li>Folder Name: RCE (choose an arbitrary name)</li><li>External Storage: Local</li><li>Authentication: None</li><li>Configuration: Set the directory to a path accessible by the web server, for example: <code>/var/www/html</code>. For simplicity, I have set up <code>/</code>.</li><li>Available for: For the purpose of this PoC, this share is configured to be accessible by all users ("<em>All people</em>"). In a real-world attack, an attacker could limit this to specific users or groups.</li></ul><p><img alt="Add Local File Storage" loading=lazy src=/images/articles/nextcloud-rce/local_storage.png></p><h3 id=3-web-shell-upload-and-remote-code-execution>3. Web Shell Upload and Remote Code Execution<a hidden class=anchor aria-hidden=true href=#3-web-shell-upload-and-remote-code-execution>#</a></h3><p>With the storage mounted, we can now upload and execute a web shell.</p><p>In the main application interface, navigate to <em>All files</em>. You will see the newly created <em>RCE</em> share.</p><p><img alt="RCE folder" loading=lazy src=/images/articles/nextcloud-rce/RCE_folder.png></p><p>The critical requirement for this exploit is that the uploaded file must be placed within a directory that is publicly accessible via the web server. By mounting the root filesystem <code>/</code>, we find and gain access to the web server&rsquo;s document root (e.g. <code>/var/www/html</code>). We can then target a specific, existing folder that is already served by the web server.
A perfect candidate for this is the <code>/updater</code> folder, which is used by Nextcloud for the built-in updater. This folder is already web-accessible and often has the necessary permissions. Uploading our file here ensures it is instantly available at <code>http://&lt;TARGET_IP>/updater/</code>.</p><p>Create the <em>updater</em> folder if it is not already present and upload a file (e.g. shell.php) containing a simple PHP web shell. For this demonstration, I used a basic one-liner:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span> <span class=nx>system</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;cmd&#39;</span><span class=p>]);</span> <span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></div><p><img alt="Upload PHP Web Shell" loading=lazy src=/images/articles/nextcloud-rce/upload_shell.png></p><p>Once uploaded, the file resides directly in <code>/var/www/html/updater/</code> on the server. You can now trigger command execution by accessing the file directly via the web server.</p><h3 id=4-triggering-rce>4. Triggering RCE<a hidden class=anchor aria-hidden=true href=#4-triggering-rce>#</a></h3><p>The web shell is now directly accessible. Execute arbitrary commands by making an HTTP GET request to the following link: <code>http://&lt;TARGET_IP>/updater/shell.php?cmd=&lt;COMMAND></code></p><p><img alt=RCE loading=lazy src=/images/articles/nextcloud-rce/trigger_rce.png></p><h2 id=remediations>Remediations<a hidden class=anchor aria-hidden=true href=#remediations>#</a></h2><p>Disable the ability for users to create new external storages of type <em>Local</em> by adding the following entry to the <em>config.php (/var/www/html/config/config.php)</em> file. This directly closes the primary vulnerability demonstrated in this PoC.</p><pre tabindex=0><code>&#39;files_external_allow_create_new_local&#39; =&gt; false
</code></pre><h1 id=rce-via-file-actions-app-abusing-elevated-privileges-for-code-execution>RCE via &ldquo;File Actions&rdquo; app: Abusing Elevated Privileges for Code Execution<a hidden class=anchor aria-hidden=true href=#rce-via-file-actions-app-abusing-elevated-privileges-for-code-execution>#</a></h1><h2 id=overview>Overview<a hidden class=anchor aria-hidden=true href=#overview>#</a></h2><p>The <em>File Actions</em> app extends Nextcloud&rsquo;s functionality by allowing administrators to define a custom script that could be run through the file actions menu in the Files app.</p><p>The critical attack vector is introduced through its support for <em>Lua</em> scripting. This feature permits the definition of a file action where the associated command is a custom Lua script.</p><h2 id=prerequisites-1>Prerequisites<a hidden class=anchor aria-hidden=true href=#prerequisites-1>#</a></h2><p>The exploitation path requires an account with the following necessary privilege:</p><ul><li><strong>Ability to install/enable apps (plugins)</strong> - permission to install, enable or configure apps.</li></ul><p>By default, this capability is restricted to admin. For clarity and reproducibility, the following demonstration uses an admin user who already possesses the required permission.</p><h2 id=proof-of-concept-1>Proof of Concept<a hidden class=anchor aria-hidden=true href=#proof-of-concept-1>#</a></h2><h3 id=1-install-and-enable-the-file-actions-app>1. Install and enable the <em>File Actions</em> app<a hidden class=anchor aria-hidden=true href=#1-install-and-enable-the-file-actions-app>#</a></h3><p>As an administrator, navigate to the <em>Apps</em> management section, search for the <em>File Actions</em> app, allow untested apps to make it available, and finally install and enable it to integrate new file action capabilities into the platform.</p><p><img alt="Install lua script plugin" loading=lazy src=/images/articles/nextcloud-rce/install_script_plugin.png></p><h3 id=2-create-a-new-file-action>2. Create a new file action<a hidden class=anchor aria-hidden=true href=#2-create-a-new-file-action>#</a></h3><p>Navigate to <em>Administration settings</em> ‚Üí <em>File Actions</em> and create a new action.</p><p><img alt="New action" loading=lazy src=/images/articles/nextcloud-rce/new-action.png></p><p>The core of this exploitation lies in using the <code>shell_command</code> function provided by <em>File Actions</em> API (<a href=https://github.com/Raudius/files_scripts/blob/master/docs/Functions.md)>https://github.com/Raudius/files_scripts/blob/master/docs/Functions.md)</a>, which allows executing operating system-level commands on the underlying server.</p><p><strong>Configuring User Inputs:</strong></p><p>This step is crucial for interactively passing commands to the shell.
In the <em>User inputs</em> section, add a new input variable.</p><ul><li>Set the Type to Text.</li><li>Set the Name (e.g. <em>cmd</em>). This name must match the one used in the Lua script.</li><li>Save the input variable.</li></ul><p>Paste the following Lua script into the command editor. This script dynamically executes any command supplied through the user input.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=n>result</span> <span class=o>=</span> <span class=n>shell_command</span><span class=p>(</span><span class=n>get_input</span><span class=p>(</span><span class=s1>&#39;cmd&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>add_message</span><span class=p>(</span><span class=n>result.output</span><span class=p>)</span>
</span></span></code></pre></div><p><strong>Explanation of the Script:</strong></p><ul><li><p><strong>get_input(&lsquo;cmd&rsquo;)</strong>: This function retrieves the command string from the user input field named <em>cmd</em>.</p></li><li><p><strong>shell_command(&mldr;)</strong>: This is the critical function that executes the supplied string as a shell command on the underlying operating system. The result of the execution is stored in the <em>result</em> variable.</p></li><li><p><strong>add_message(result.output)</strong>: This function takes the standard output (<em>result.output</em>) from the shell command and displays it to the user as a message within the Nextcloud interface. This provides immediate feedback and exfiltration of command results.</p></li></ul><p><img alt="New action 2" loading=lazy src=/images/articles/nextcloud-rce/new-action-2.png></p><p>Once this action is saved, you must enable the <em>Experimental Interpreter</em>. This setting is crucial as it allows the system to process and execute the custom Lua code.</p><p><img alt="Enable exp interpreter" loading=lazy src=/images/articles/nextcloud-rce/new-action-3.png></p><h3 id=3-exploit-rce>3. Exploit RCE<a hidden class=anchor aria-hidden=true href=#3-exploit-rce>#</a></h3><p>After enabling the interpreter, the action will appear in the file actions menu within the Files app. Simply select a file, open its context menu, and select your custom action (e.g., <em>RCE</em>). This will open a dialog box prompting for the <em>cmd</em> input. Enter any system command here to execute it on the server.</p><p><img alt=RCE loading=lazy src=/images/articles/nextcloud-rce/exec-action.png></p><p>The command entered will be executed on the server and the output will be displayed directly in the Nextcloud interface. The following figures show the execution of the <code>id</code> command via the file action created previously (<em>RCE</em>).</p><p><img alt=RCE_2 loading=lazy src=/images/articles/nextcloud-rce/exec-action-2.png></p><p><img alt=RCE_3 loading=lazy src=/images/articles/nextcloud-rce/exec-action-3.png></p><h2 id=remediations-1>Remediations<a hidden class=anchor aria-hidden=true href=#remediations-1>#</a></h2><p>To completely remove the risk of malicious app installation, disable the app store for all users by adding the following entry to the <em>config.php (/var/www/html/config/config.php)</em> file. This prevents any user, including admins, from browsing or installing new applications from the web interface.</p><pre tabindex=0><code>&#39;appstoreenabled&#39; =&gt; false
</code></pre></div><footer class=post-footer><ul class=post-tags><li><a href=http://localhost:1313/tags/red-team/>Red Team</a></li><li><a href=http://localhost:1313/tags/penetration-test/>Penetration Test</a></li><li><a href=http://localhost:1313/tags/cloud/>Cloud</a></li></ul><nav class=paginav><a class=next href=http://localhost:1313/blog/nasa-vdp/><span class=title>Next ¬ª</span><br><span>Spatial VDP: How I Rocked-Boosted a NASA XSS from P5 to P2 üöÄ</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=http://localhost:1313/>Giacomo Lenzini</a></span> ¬∑
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>